{% extends 'base.html.twig' %}

{% block body %}
    <div id="acceuil">

        <div id="infos">
            <div>
                <p>Date du jour : {{ "now"|date("d/m/Y") }}</p>
                <p>Participant : {{ app.user.prenom}} {{ app.user.nom | slice(0,1)}}. </p>
            </div>
        </div>
        <h2>Filtrer les sorties</h2>

        <div id="filtres">
            {{  form_start(filtreForm) }}
            <div>
                <div id="acceuil-filtres-partLeft">
                    {{  form_row(filtreForm.nomCampus) }} <br>
                    {{  form_row(filtreForm.nomSortie) }}<br>
                    {{  form_row(filtreForm.dateSortie1) }} {{  form_row(filtreForm.dateSortie2) }}<br>
                </div>
                <div id="acceuil-filtres-partRight">
                    {{  form_row(filtreForm.organisateur) }}<br><br>
                    {{  form_row(filtreForm.inscrit) }}<br><br>
                    {{  form_row(filtreForm.pasInscrit) }}<br><br>
                    {{  form_row(filtreForm.sortiepassees) }}
                </div>
                <div id="button-filtre">
                    <button type="submit">Rechercher</button>
                </div>
            </div>
            {{  form_end(filtreForm) }}
        </div>

        <div id="listeSortie">
            <table border="1">
                <tr>
                    <td>Nom de la sortie</td>
                    <td>Date de la sortie</td>
                    <td>Clôture</td>
                    <td>inscrits/places</td>
                    <td>Etat</td>
                    <td>Inscrit</td>
                    <td>Organisateur</td>
                    <td>Actions</td>
                </tr>
                {% for sortie in sorties %}
                    <tr>
                        <td>{{ sortie.nom }}</td>
                        <td>{{ sortie.dateHeureDebut |date('d/m/y H:i') }}</td>
                        <td>{{ sortie.dateLimiteInscription |date('d/m/y') }}</td>
                        <td>{{ sortie.participants.count }}/{{ sortie.nbInscriptionsMax }}</td>
                        <td>{{ sortie.etat.libelle }}</td>
                        <td>
                            {% if app.user in sortie.participants %}
                                X
                            {% endif %}
                        </td>
                        <td>{{ sortie.organisateur.prenom }} {{ sortie.organisateur.nom | slice(0,1) }}.</td>
                        <td>
                            {% if sortie.organisateur  == app.user %}
                                {% if sortie.etat.libelle == 'Créée' %}
                                    <a href="{{ path('sortie_update', {'idSortie': sortie.idSortie}) }}">Modifier</a> - Publier
                                {% else %}
                                    Afficher - Annuler
                                {% endif %}
                            {% elseif not (sortie.organisateur  == app.user) and app.user in sortie.participants %}
                                Afficher - Se désister
                            {% else %}
                                Afficher - S'inscrire
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>

        <div>
            <button><a href="{{ path('sortie_create') }}" title="Créer une sortie" type="submit">Créer une sortie</a></button>
        </div>

    </div>
{% endblock %}

{% block title %}
    {{ parent() }} | Acceuil
{% endblock %}